<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.greenart.bdproject.mapper.FavoriteWelfareServiceMapper">

    <!-- resultMap: FavoriteWelfareServiceResult → FavoriteWelfareServiceDto -->
    <resultMap id="FavoriteWelfareServiceResult" type="com.greenart.bdproject.dto.FavoriteWelfareServiceDto">
        <result property="memberId" column="member_id"/>
        <result property="serviceId" column="service_id"/>
        <result property="serviceName" column="service_name"/>
        <result property="servicePurpose" column="service_purpose"/>
        <result property="department" column="department"/>
        <result property="applyMethod" column="apply_method"/>
        <result property="supportType" column="support_type"/>
        <result property="lifecycleCode" column="lifecycle_code"/>
        <result property="memo" column="memo"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- 즐겨찾기 추가 -->
    <insert id="insert" parameterType="com.greenart.bdproject.dto.FavoriteWelfareServiceDto">
        INSERT INTO favorite_welfare_services (
            member_id, service_id, service_name, service_purpose,
            department, apply_method, support_type, lifecycle_code, memo, created_at
        )
        VALUES (
            #{memberId}, #{serviceId}, #{serviceName}, #{servicePurpose},
            #{department}, #{applyMethod}, #{supportType}, #{lifecycleCode}, #{memo}, NOW()
        )
    </insert>

    <!-- 즐겨찾기 삭제 -->
    <delete id="delete" parameterType="map">
        DELETE FROM favorite_welfare_services
        WHERE member_id = #{memberId} AND service_id = #{serviceId}
    </delete>

    <!-- 회원의 모든 즐겨찾기 조회 -->
    <select id="selectByMemberId" parameterType="long" resultMap="FavoriteWelfareServiceResult">
        SELECT member_id, service_id, service_name, service_purpose,
               department, apply_method, support_type, lifecycle_code, memo, created_at
        FROM favorite_welfare_services
        WHERE member_id = #{memberId}
        ORDER BY created_at DESC
    </select>

    <!-- 특정 서비스가 즐겨찾기에 있는지 확인 -->
    <select id="exists" parameterType="map" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM favorite_welfare_services
        WHERE member_id = #{memberId} AND service_id = #{serviceId}
    </select>

    <!-- 회원의 즐겨찾기 개수 조회 -->
    <select id="countByMemberId" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM favorite_welfare_services
        WHERE member_id = #{memberId}
    </select>

</mapper>
