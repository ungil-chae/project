<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.greenart.bdproject.mapper.NotificationSettingsMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="notificationSettingsResultMap" type="com.greenart.bdproject.dto.NotificationSettings">
        <id property="settingId" column="setting_id"/>
        <result property="memberId" column="member_id"/>
        <result property="eventNotification" column="event_notification"/>
        <result property="donationNotification" column="donation_notification"/>
        <result property="volunteerNotification" column="volunteer_notification"/>
        <result property="faqAnswerNotification" column="faq_answer_notification"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 회원 ID로 알림 설정 조회 -->
    <select id="selectByMemberId" parameterType="long" resultMap="notificationSettingsResultMap">
        SELECT
            setting_id,
            member_id,
            event_notification,
            donation_notification,
            volunteer_notification,
            faq_answer_notification,
            created_at,
            updated_at
        FROM notification_settings
        WHERE member_id = #{memberId}
    </select>

    <!-- 알림 설정 저장 -->
    <insert id="insert" parameterType="com.greenart.bdproject.dto.NotificationSettings"
            useGeneratedKeys="true" keyProperty="settingId">
        INSERT INTO notification_settings (
            member_id,
            event_notification,
            donation_notification,
            volunteer_notification,
            faq_answer_notification
        ) VALUES (
            #{memberId},
            #{eventNotification},
            #{donationNotification},
            #{volunteerNotification},
            #{faqAnswerNotification}
        )
    </insert>

    <!-- 알림 설정 수정 -->
    <update id="update" parameterType="com.greenart.bdproject.dto.NotificationSettings">
        UPDATE notification_settings
        SET
            event_notification = #{eventNotification},
            donation_notification = #{donationNotification},
            volunteer_notification = #{volunteerNotification},
            faq_answer_notification = #{faqAnswerNotification},
            updated_at = CURRENT_TIMESTAMP
        WHERE member_id = #{memberId}
    </update>

    <!-- 알림 설정 UPSERT (INSERT ... ON DUPLICATE KEY UPDATE) -->
    <insert id="upsert" parameterType="com.greenart.bdproject.dto.NotificationSettings">
        INSERT INTO notification_settings (
            member_id,
            event_notification,
            donation_notification,
            volunteer_notification,
            faq_answer_notification
        ) VALUES (
            #{memberId},
            #{eventNotification},
            #{donationNotification},
            #{volunteerNotification},
            #{faqAnswerNotification}
        )
        ON DUPLICATE KEY UPDATE
            event_notification = VALUES(event_notification),
            donation_notification = VALUES(donation_notification),
            volunteer_notification = VALUES(volunteer_notification),
            faq_answer_notification = VALUES(faq_answer_notification),
            updated_at = CURRENT_TIMESTAMP
    </insert>

    <!-- 알림 설정 삭제 -->
    <delete id="delete" parameterType="long">
        DELETE FROM notification_settings
        WHERE member_id = #{memberId}
    </delete>

</mapper>
